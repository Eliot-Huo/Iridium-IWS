# SBD è¡›æ˜Ÿè¨­å‚™ç®¡ç†ç³»çµ± v6.37.0 æ›´æ–°èªªæ˜
## ä¼æ¥­ç´šé‡æ§‹ç‰ˆ - ä¿ç•™æ‰€æœ‰åŠŸèƒ½

**ç™¼å¸ƒæ—¥æœŸï¼š** 2026-01-04  
**ç‰ˆæœ¬ï¼š** 6.37.0  
**é‡æ§‹åŸå‰‡ï¼š** âœ… **åªæ·»åŠ ï¼Œä¸åˆªé™¤**

---

## ğŸ¯ æ›´æ–°æ‘˜è¦

é€™æ¬¡æ›´æ–°**æ·»åŠ äº†ä¼æ¥­ç´šæ¶æ§‹**ï¼ŒåŒæ™‚**å®Œæ•´ä¿ç•™æ‰€æœ‰ v6.36.0 çš„åŠŸèƒ½**ã€‚

### âœ… **ä¿ç•™çš„æ‰€æœ‰åŠŸèƒ½ï¼š**

1. **å®¢æˆ¶ç«¯åŠŸèƒ½ï¼š**
   - âœ… CDR å¸³å–®æŸ¥è©¢ï¼ˆå®Œæ•´ä¿ç•™ï¼‰
   - âœ… è²»ç”¨æŸ¥è©¢
   - âœ… æ‰€æœ‰åŸæœ‰æŸ¥è©¢åŠŸèƒ½

2. **åŠ©ç†ç«¯åŠŸèƒ½ï¼š**
   - âœ… è¨­å‚™ç®¡ç†
   - âœ… æ–¹æ¡ˆç®¡ç†
   - âœ… è«‹æ±‚å¯©æ‰¹
   - âœ… CDR åŒæ­¥ç®¡ç†ï¼ˆè‡ªå‹•æ¯å°æ™‚ä¸‹è¼‰ï¼‰
   - âœ… CDR ç®¡ç†é é¢
   - âœ… åƒ¹æ ¼ç®¡ç†
   - âœ… æ‰€æœ‰åŠ©ç†åŠŸèƒ½

3. **CDR åŠŸèƒ½ï¼š**
   - âœ… è‡ªå‹• FTP ä¸‹è¼‰ï¼ˆæ¯å°æ™‚ï¼‰
   - âœ… TAP II æ ¼å¼è§£æ
   - âœ… Google Drive ä¸Šå‚³ï¼ˆå¹´/æœˆ/æ—¥ çµæ§‹ï¼‰
   - âœ… æœ¬åœ°å¿«å–ç®¡ç†
   - âœ… å¢é‡åŒæ­¥ç³»çµ±

4. **å…¶ä»–åŠŸèƒ½ï¼š**
   - âœ… æœå‹™è«‹æ±‚è¿½è¹¤
   - âœ… å¾Œå°è¼ªè©¢ï¼ˆå¯é¸ï¼‰
   - âœ… æ‰€æœ‰ 7 å€‹é é¢å®Œæ•´ä¿ç•™

---

## ğŸ†• **æ–°å¢çš„ä¼æ¥­ç´šåŠŸèƒ½ï¼š**

### 1. ç•°å¸¸è™•ç†é«”ç³» (`src/utils/exceptions.py`)

**27 å€‹å°ˆç”¨ç•°å¸¸é¡åˆ¥ï¼š**
```python
from src.utils.exceptions import (
    ValidationError,
    IMEIValidationError,
    BillingCalculationError,
    ResourceNotFoundError,
    NetworkError,
    # ... ç­‰ 22 å€‹
)

# ä½¿ç”¨ç¯„ä¾‹
try:
    result = billing_service.query(imei)
except IMEIValidationError as e:
    logger.error("IMEI validation failed", exception=e)
    st.error(f"âŒ {e.message}")
```

**ç‰¹è‰²ï¼š**
- âœ… çµæ§‹åŒ–éŒ¯èª¤è³‡è¨Šï¼ˆmessage, details, severity, timestampï¼‰
- âœ… è‡ªå‹•éæ¿¾æ•æ„Ÿè³‡è¨Šï¼ˆpassword, api_key ç­‰ï¼‰
- âœ… æ•´åˆåˆ°æ—¥èªŒç³»çµ±

### 2. çµæ§‹åŒ–æ—¥èªŒç³»çµ± (`src/utils/logger.py`)

**JSON æ ¼å¼æ—¥èªŒï¼š**
```python
from src.utils import get_logger

logger = get_logger('MyService')
logger.info("CDR downloaded", imei='300534066711380', year=2026, month=1)

# è¼¸å‡ºï¼ˆJSON æ ¼å¼ï¼‰
{
  "timestamp": "2026-01-04T13:20:00.123456",
  "level": "INFO",
  "logger": "MyService",
  "message": "CDR downloaded",
  "imei": "***********1380",  # è‡ªå‹•é®ç½©
  "year": 2026,
  "month": 1
}
```

**ç‰¹è‰²ï¼š**
- âœ… JSON æ ¼å¼ï¼ˆä¾¿æ–¼ ELK/CloudWatch è§£æï¼‰
- âœ… è‡ªå‹•éæ¿¾æ•æ„Ÿè³‡è¨Š
- âœ… æ•´åˆç•°å¸¸è©³æƒ…
- âœ… æ”¯æ´å¤šç¨®æ—¥èªŒç­‰ç´š

### 3. ä¾è³´æ³¨å…¥å®¹å™¨ (`src/di/service_factory.py`)

**çµ±ä¸€æœå‹™ç®¡ç†ï¼š**
```python
from src.di import get_service_factory

# åˆå§‹åŒ–ï¼ˆè‡ªå‹•å¾ st.secrets è®€å–ï¼‰
factory = get_service_factory()
factory.initialize_from_secrets(st.secrets)

# ä½¿ç”¨æœå‹™
gateway = factory.gateway
billing_service = factory.billing_service
cdr_service = factory.cdr_service
```

**ç‰¹è‰²ï¼š**
- âœ… å–®ä¾‹æ¨¡å¼ï¼ˆæœå‹™åªå‰µå»ºä¸€æ¬¡ï¼‰
- âœ… è‡ªå‹•ä¾è³´æ³¨å…¥
- âœ… é›†ä¸­é…ç½®ç®¡ç†
- âœ… å‘å¾Œå…¼å®¹ï¼ˆèˆŠä»£ç¢¼ä»å¯ç›´æ¥å‰µå»ºæœå‹™ï¼‰

---

## ğŸ“‹ **æª”æ¡ˆçµæ§‹ï¼š**

### **æ ¸å¿ƒæª”æ¡ˆï¼ˆå®Œå…¨ä¿ç•™ï¼‰ï¼š**
```
app.py                              (675 è¡Œï¼Œå®Œæ•´ä¿ç•™)
render_assistant_page_v2.py         (205 è¡Œï¼Œå®Œæ•´ä¿ç•™)
render_billing_page.py              (773 è¡Œï¼Œå®Œæ•´ä¿ç•™)
render_cdr_billing_query_page.py    (700 è¡Œï¼Œå®Œæ•´ä¿ç•™)
render_cdr_management_page.py       (358 è¡Œï¼Œå®Œæ•´ä¿ç•™)
render_price_management_page.py     (378 è¡Œï¼Œå®Œæ•´ä¿ç•™)
render_sync_page.py                 (321 è¡Œï¼Œå®Œæ•´ä¿ç•™)
```

### **æ–°å¢çš„ä¼æ¥­ç´šæ¨¡çµ„ï¼š**
```
src/
â”œâ”€â”€ utils/                    # æ–°å¢
â”‚   â”œâ”€â”€ exceptions.py         # 27 å€‹ç•°å¸¸é¡åˆ¥
â”‚   â”œâ”€â”€ security.py           # å®‰å…¨å·¥å…·ï¼ˆIMEI é©—è­‰ç­‰ï¼‰
â”‚   â”œâ”€â”€ logger.py             # çµæ§‹åŒ–æ—¥èªŒ
â”‚   â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ di/                       # æ–°å¢
â”‚   â”œâ”€â”€ service_factory.py    # ä¾è³´æ³¨å…¥å®¹å™¨
â”‚   â””â”€â”€ __init__.py
â”‚
â””â”€â”€ (æ‰€æœ‰åŸæœ‰æ¨¡çµ„å®Œæ•´ä¿ç•™)
    â”œâ”€â”€ services/
    â”œâ”€â”€ infrastructure/
    â”œâ”€â”€ models/
    â”œâ”€â”€ repositories/
    â”œâ”€â”€ parsers/
    â””â”€â”€ config/
```

---

## ğŸ”„ **é·ç§»æŒ‡å—ï¼š**

### **ä¸éœ€è¦æ”¹ä»»ä½•ç¾æœ‰ç¨‹å¼ç¢¼ï¼**

é€™æ¬¡æ›´æ–°æ˜¯**å®Œå…¨å‘å¾Œå…¼å®¹**çš„ï¼š
- âœ… æ‰€æœ‰åŸæœ‰åŠŸèƒ½æ­£å¸¸é‹ä½œ
- âœ… å¯ä»¥é¸æ“‡æ€§ä½¿ç”¨æ–°åŠŸèƒ½
- âœ… èˆŠç¨‹å¼ç¢¼ä¸éœ€è¦ä¿®æ”¹

### **å¦‚ä½•ä½¿ç”¨æ–°åŠŸèƒ½ï¼ˆå¯é¸ï¼‰ï¼š**

#### 1. ä½¿ç”¨çµæ§‹åŒ–æ—¥èªŒï¼ˆå¯é¸ï¼‰
```python
# åœ¨ä»»ä½•æª”æ¡ˆä¸­
from src.utils import get_logger

logger = get_logger('MyModule')
logger.info("Something happened", user_id='123', action='login')
```

#### 2. ä½¿ç”¨è‡ªè¨‚ç•°å¸¸ï¼ˆå¯é¸ï¼‰
```python
from src.utils.exceptions import ValidationError

try:
    # æ‚¨çš„ç¨‹å¼ç¢¼
    pass
except Exception as e:
    raise ValidationError(field='imei', value=imei, reason='Invalid format')
```

#### 3. ä½¿ç”¨ ServiceFactoryï¼ˆå¯é¸ï¼‰
```python
# åœ¨ app.py å·²ç¶“æ•´åˆï¼Œå…¶ä»–æª”æ¡ˆå¯é¸
from src.di import get_service_factory

factory = get_service_factory()
gateway = factory.gateway
```

---

## âœ… **æ¸¬è©¦é©—è­‰ï¼š**

### **æ‰€æœ‰åŠŸèƒ½æ¸¬è©¦æ¸…å–®ï¼š**

#### å®¢æˆ¶ç«¯ï¼š
- [ ] CDR å¸³å–®æŸ¥è©¢ - å¯ä»¥æŸ¥è©¢ 2026/01 çš„è³‡æ–™
- [ ] è²»ç”¨æŸ¥è©¢ - æ­£å¸¸é‹ä½œ
- [ ] æ‰€æœ‰æŸ¥è©¢åŠŸèƒ½ - æ­£å¸¸é‹ä½œ

#### åŠ©ç†ç«¯ï¼š
- [ ] è¨­å‚™ç®¡ç† - æ­£å¸¸é‹ä½œ
- [ ] æ–¹æ¡ˆç®¡ç† - æ­£å¸¸é‹ä½œ
- [ ] è«‹æ±‚å¯©æ‰¹ - æ­£å¸¸é‹ä½œ
- [ ] CDR åŒæ­¥ç®¡ç† - æ¯å°æ™‚è‡ªå‹•ä¸‹è¼‰
- [ ] CDR ç®¡ç†é é¢ - æ­£å¸¸é‹ä½œ
- [ ] åƒ¹æ ¼ç®¡ç† - æ­£å¸¸é‹ä½œ

#### CDR ç³»çµ±ï¼š
- [ ] FTP è‡ªå‹•ä¸‹è¼‰ - æ¯å°æ™‚åŸ·è¡Œ
- [ ] TAP II è§£æ - æ­£å¸¸é‹ä½œ
- [ ] Google Drive ä¸Šå‚³ - å¹´/æœˆ/æ—¥ çµæ§‹
- [ ] æœ¬åœ°å¿«å– - temp/query_cache/YYYYMM

---

## ğŸš€ **éƒ¨ç½²æ­¥é©Ÿï¼š**

### **æ–¹æ³• 1ï¼šç›´æ¥æ›¿æ›ï¼ˆæ¨è–¦ï¼‰**
```bash
# 1. ä¸‹è¼‰æ–°ç‰ˆæœ¬
# 2. è§£å£“ç¸®åˆ°å°ˆæ¡ˆç›®éŒ„
# 3. æ¨é€åˆ° GitHub
git add .
git commit -m "å‡ç´šåˆ° v6.37.0 - ä¼æ¥­ç´šé‡æ§‹ï¼ˆä¿ç•™æ‰€æœ‰åŠŸèƒ½ï¼‰"
git push origin Iridium-IWS

# 4. åœ¨ Streamlit Cloud Reboot
```

### **æ–¹æ³• 2ï¼šGit åˆ†æ”¯ï¼ˆæ›´å®‰å…¨ï¼‰**
```bash
# 1. å‰µå»ºå‚™ä»½åˆ†æ”¯
git checkout -b backup-v6.36.0
git push origin backup-v6.36.0

# 2. å›åˆ°ä¸»åˆ†æ”¯ä¸¦æ›´æ–°
git checkout Iridium-IWS
# ï¼ˆè¤‡è£½æ–°ç¨‹å¼ç¢¼ï¼‰
git add .
git commit -m "v6.37.0 - ä¼æ¥­ç´šé‡æ§‹"
git push origin Iridium-IWS
```

---

## âš ï¸ **å·²çŸ¥å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆï¼š**

### **å•é¡Œ 1ï¼šæ‰¾ä¸åˆ° CDR è¨˜éŒ„**
**ç¾è±¡ï¼š** `æ‰¾ä¸åˆ° 2026/01 çš„ CDR è¨˜éŒ„`

**åŸå› ï¼š** CDR å°šæœªåŒæ­¥åˆ° Google Drive

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. åˆ°åŠ©ç†ç«¯ â†’ CDR åŒæ­¥ç®¡ç†
2. åŸ·è¡Œæ‰‹å‹•åŒæ­¥
3. ç­‰å¾… FTP ä¸‹è¼‰å®Œæˆ
4. ç¢ºèª Google Drive æœ‰ `2026/01/04` è³‡æ–™å¤¾

### **å•é¡Œ 2ï¼šStreamlit Secrets æœªè¨­å®š**
**ç¾è±¡ï¼š** `ServiceFactory initialization failed`

**è§£æ±ºæ–¹æ¡ˆï¼š**
ç¢ºèª Streamlit Cloud Secrets åŒ…å«ï¼š
```toml
IWS_USERNAME = "IWSN3D"
IWS_PASSWORD = "your_password"
IWS_SP_ACCOUNT = "200883"
IWS_ENDPOINT = "https://..."
```

---

## ğŸ“Š **æ•ˆèƒ½å½±éŸ¿ï¼š**

### **è¨˜æ†¶é«”ä½¿ç”¨ï¼š**
- **å¢åŠ ï¼š** ~5MBï¼ˆæ–°æ¨¡çµ„ï¼‰
- **ç¸½è¨ˆï¼š** èˆ‡ v6.36.0 ç›¸è¿‘

### **å•Ÿå‹•æ™‚é–“ï¼š**
- **å¢åŠ ï¼š** <1 ç§’ï¼ˆServiceFactory åˆå§‹åŒ–ï¼‰
- **ç¸½è¨ˆï¼š** èˆ‡ v6.36.0 ç›¸è¿‘

### **åŸ·è¡Œæ•ˆèƒ½ï¼š**
- **ç„¡å½±éŸ¿**ï¼ˆä¼æ¥­ç´šæ¨¡çµ„ç‚ºå¯é¸ä½¿ç”¨ï¼‰

---

## ğŸ¯ **æœªä¾†è¦åŠƒï¼š**

### **çŸ­æœŸï¼ˆæœ¬é€±ï¼‰ï¼š**
- [ ] é€æ­¥åœ¨å„æ¨¡çµ„æ•´åˆçµæ§‹åŒ–æ—¥èªŒ
- [ ] æ·»åŠ æ›´å¤šç•°å¸¸è™•ç†
- [ ] æ•ˆèƒ½ç›£æ§

### **ä¸­æœŸï¼ˆæœ¬æœˆï¼‰ï¼š**
- [ ] å–®å…ƒæ¸¬è©¦æ¡†æ¶ï¼ˆpytestï¼‰
- [ ] CI/CD æ•´åˆ
- [ ] API æ–‡æª”ç”Ÿæˆ

### **é•·æœŸï¼ˆæœ¬å­£ï¼‰ï¼š**
- [ ] æ™ºæ…§å¿«å–ç³»çµ±
- [ ] æ•ˆèƒ½å„ªåŒ–
- [ ] æ›´å¤šä¼æ¥­ç´šåŠŸèƒ½

---

## ğŸ“ **æ”¯æ´èˆ‡å›é¥‹ï¼š**

å¦‚æœ‰ä»»ä½•å•é¡Œï¼š
1. æª¢æŸ¥ `logs/` ç›®éŒ„çš„æ—¥èªŒæª”æ¡ˆ
2. æŸ¥çœ‹ Streamlit Cloud çš„éŒ¯èª¤è¨Šæ¯
3. åƒè€ƒæœ¬æ–‡ä»¶çš„ã€Œå·²çŸ¥å•é¡Œã€ç« ç¯€

---

## ğŸ“„ **ç‰ˆæœ¬æ¯”è¼ƒï¼š**

| åŠŸèƒ½ | v6.36.0 | v6.37.0 |
|------|---------|---------|
| CDR æŸ¥è©¢ | âœ… | âœ… |
| åŠ©ç†åŠŸèƒ½ | âœ… | âœ… |
| æ‰€æœ‰é é¢ | âœ… | âœ… |
| ç•°å¸¸è™•ç† | âŒ | âœ… |
| çµæ§‹åŒ–æ—¥èªŒ | âŒ | âœ… |
| ä¾è³´æ³¨å…¥ | âŒ | âœ… |
| å‘å¾Œå…¼å®¹ | N/A | âœ… |

---

**ç¸½çµï¼šv6.37.0 = v6.36.0 çš„æ‰€æœ‰åŠŸèƒ½ + ä¼æ¥­ç´šæ¶æ§‹**

**ç«‹å³å‡ç´šï¼Œç„¡é¢¨éšªï¼** ğŸš€
